# Cookbook for shellcode execution 

## Shellcode storage 
### Staged shellcode with HTTP/HTTPS

- Create an Internet handle (InternetOpenW)
- Open the created handle with the used URL (InternetOpenUrlW)
- Create a buffer (LocalAlloc)    
- Reads data from the web handle (InternetReadFile)
- ðŸš¿ Close the handle (InternetCloseHandle) ðŸš¿ 
- ðŸš¿ Close HTTP/HTTPS connection (InternetSetOptionW) ðŸš¿
- ðŸš¿ Free the buffer (LocalFree) ðŸš¿ 
  
### with Windows Registry


## Execution

### Prepation for remote process injection

For remotely, first enumerate processes:
- Take a "picture" of the running processes (CreateToolhelp32Snapshot())
- Get information on these processes (Process32First then Process32Next())
Then, make space for your shellcode, execute it and clean up your mess:

### Execution step

- **Create memory space** (VirtualAlloc() - VirtualAllocEx())
- **Copy the shellcode** in the memory space (memcpy() - WriteProcessMemory())
- ðŸš¿ Fill the initial shellcode's memory (memset()) ðŸš¿
- **Allow execution** of this memory space (VirtualProtect() - VirtualProtectEx())
- **Execute the code** in the memory space (CreateThread() - CreateRemoteThread())
- ðŸš¿ Clean the memory space (HeapFree()) ðŸš¿
